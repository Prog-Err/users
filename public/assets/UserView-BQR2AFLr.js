import{d as B,r as m,s as M,o as D,x as T,c as u,f as r,t as h,m as p,v as y,n as w,a as d,e as v,F as q,g as z,b as F,w as $,k as O,y as S,q as j,i,z as A,j as x}from"./index-DOcY17eO.js";import{a as f}from"./axios-api-DSUBSmZb.js";import{r as _,m as V,e as G,u as H,L as E}from"./LoadingButton-s7Exbs-U.js";const I={class:"container mt-4"},J={class:"mb-3"},K=["disabled"],P={key:0,class:"invalid-feedback"},Q={class:"mb-3"},W=["disabled"],X={key:0,class:"invalid-feedback"},Y={class:"mb-3"},Z=["disabled"],ee={key:0,class:"invalid-feedback"},ae={class:"mb-3"},se=r("label",null,"Роли:",-1),le=["value","disabled"],re={class:"form-check-label"},te={key:0,class:"text-danger"},de=B({__name:"UserView",setup(oe){const c=S(),k=j(),l=m(!1),b=m(""),U=m(["ROLE_ADMIN","ROLE_USER"]),s=m({id:0,username:"",email:"",password:"",roles:[]}),n=M(()=>c.params.id!=="new"),L={user:{username:{required:_,minLength:V(3)},email:{required:_,email:G},password:n.value?{}:{required:_,minLength:V(4)},roles:{required:_}}},o=H(L,{user:s}),g=async a=>{l.value=!0,b.value="Загрузка...";try{const e=await f.get(`/users/${a}`);if(e.data)s.value=e.data,o.value.$reset();else throw new Error(e.data.error||"Не удалось загрузить пользователя")}catch(e){console.error("Не удалось загрузить пользователя:",e)}finally{l.value=!1}},C=async()=>{if(o.value.$touch(),!o.value.$invalid){l.value=!0,b.value="Сохранение...";try{if(n.value)await f.put(`/users/${c.params.id}`,s.value);else{const a=await f.post("/users",s.value);if(a.data)k.push(`/user/${a.data}`);else throw new Error(a.data.error||"Не удалось сохранить пользователя")}}catch(a){console.error("Не удалось сохранить пользователя:",a)}finally{l.value=!1}}},N=async()=>{l.value=!0;try{(await f.delete(`/users/${c.params.id}`)).data.status&&k.push("/")}catch(a){console.error("Не удалось удалить пользователя:",a)}finally{l.value=!1}};return D(()=>{n.value&&c.params.id&&g(Number(c.params.id))}),T(()=>c.params.id,a=>{n.value&&a?g(Number(a)):s.value={username:"",password:"",roles:[],email:"",id:0}}),(a,e)=>(i(),u("div",I,[r("h1",null,h(n.value?"Редактирование пользователя":"Добавление пользователя"),1),r("div",null,[r("div",J,[p(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.username=t),type:"text",class:w(["form-control",{"is-invalid":d(o).user.username.$error}]),placeholder:"Имя пользователя",disabled:l.value},null,10,K),[[y,s.value.username]]),d(o).user.username.$error?(i(),u("div",P," Имя пользователя обязательно и должно содержать минимум 3 символа. ")):v("",!0)]),r("div",Q,[p(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.email=t),type:"email",class:w(["form-control",{"is-invalid":d(o).user.email.$error}]),placeholder:"Email",disabled:l.value},null,10,W),[[y,s.value.email]]),d(o).user.email.$error?(i(),u("div",X," Email обязателен и должен быть в правильном формате. ")):v("",!0)]),r("div",Y,[p(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.password=t),type:"password",class:w(["form-control",{"is-invalid":d(o).user.password.$error}]),placeholder:"Пароль",disabled:l.value},null,10,Z),[[y,s.value.password]]),d(o).user.password.$error?(i(),u("div",ee," Пароль обязателен и должен содержать минимум 4 символа. ")):v("",!0)]),r("div",ae,[se,(i(!0),u(q,null,z(U.value,t=>(i(),u("div",{key:t,class:"form-check"},[p(r("input",{class:"form-check-input",type:"checkbox",value:t,"onUpdate:modelValue":e[3]||(e[3]=R=>s.value.roles=R),disabled:l.value},null,8,le),[[A,s.value.roles]]),r("label",re,h(t),1)]))),128)),d(o).user.roles.$error?(i(),u("div",te," Должна быть выбрана как минимум одна роль. ")):v("",!0)]),F(E,{loading:l.value,"button-class":"btn-primary","loading-text":b.value,onClick:e[4]||(e[4]=t=>C())},{default:$(()=>[x(h(n.value?"Обновить пользователя":"Добавить пользователя"),1)]),_:1},8,["loading","loading-text"]),n.value?(i(),O(E,{key:0,loading:l.value,"button-class":"btn-danger ms-2","loading-text":"Удалить пользователя",onClick:e[5]||(e[5]=t=>N())},{default:$(()=>[x(" Удалить пользователя ")]),_:1},8,["loading"])):v("",!0)])]))}});export{de as default};
